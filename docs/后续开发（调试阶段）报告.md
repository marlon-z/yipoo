# 后续开发（调试阶段）报告

> 本文档用于指导当前阶段（以调试为主）的工作，聚焦稳定性、性能、导出一致性与可见性收敛；协作仅维持占位能力。

## 一、当前状态
- 已达成：四格式导出（Markdown/HTML/PDF/DOCX）、导出参数面板与顶部联动、任务/错误可见、错误详情抽屉、解析/渲染 Worker 化、状态栏展示解析/渲染/端到端耗时与任务平均进度、协作占位（开关/只读/光标/离线/成员假数据）。
- 未完项：协作真实实现、性能目标阈值闭环与降级策略、导出质量进一步打磨（PDF 字体/分页、Docx 图片/表格样式）。
- 结论：项目暂处于 M3 收尾后“调试阶段”，目标为稳定交付与性能/质量对齐。

## 二、调试目标（OKR）
- O1 稳定性：无崩溃/空白页/未捕获异常，错误均可见、可复制、可定位。
- O2 性能达标：输入→预览 <120ms；模式切换 <150ms；TOC 生成 <50ms/1000 标题（P95）。
- O3 导出一致性：HTML/PDF/DOCX 在主流浏览器表现一致、编码/字体/分页/样式无明显回退；失败可回退并提示。
- O4 可见性闭环：状态栏与抽屉能定位到任务与错误详情；指标超阈值高亮提示与记录。

## 三、范围与优先级（P0/P1）
- P0（立即修复）
  - 导出失败/空文件/乱码/崩溃/卡死
  - Worker 卡住/消息丢失/多次触发/端到端耗时远超阈值
  - 状态栏/任务进度不更新或误报、错误抽屉打不开
  - 大文档卡顿明显且无提示（缺降级/进度/占位）
- P1（持续修复）
  - PDF 字体/分页/页码细节、Docx 样式覆盖面与图片/表格占位
  - 解析与渲染细节（高亮主题差异、标题锚点、自动链接）
  - SSR/CSR 护栏与浏览器兼容边界（Safari/Firefox 差异）

## 四、测试环境与覆盖矩阵
- 浏览器：Chrome ≥ 126、Safari ≥ 17、Firefox ≥ 129（至少 2 款通过）
- 操作系统：macOS 14+（主）、Windows 11（抽样）
- 文档规模：1k/10k/50k 字；含代码块/公式/表格/图片的混合场景
- 模式：所见即所得/源码/分屏；含导出与切换

## 五、调试清单（建议执行顺序）
- 基线体验
  - 打开/编辑/自动保存/离页保存/恢复 -> 不丢数据，无错误
  - 模式切换（所见/源码/分屏）-> 无白屏，无状态错乱
- 性能与可见性
  - 输入→预览：观察 parseMs/renderMs/endToEndMs（状态栏）并记录 P50/P95
  - 模式切换耗时（人工计时+指标对照），超阈值高亮触发与提示
  - 大文档加载/滚动/TOC 生成时间与是否触发降级
- 导出质量
  - HTML：目录、锚点、KaTeX、代码高亮一致性
  - PDF：字体/分页/页码；失败回退；跨浏览器校验
  - DOCX：标题/段落/列表/代码块为基线，图片/表格占位正确
- 任务与错误
  - 导出/渲染任务进度 0/25/50/75/100 分段是否合理
  - 异常注入（网络离线/权限拒绝/超时）是否能定位并提示
- 协作占位
  - 开关/只读态/在线状态指示/成员列表抖动逻辑稳定，不影响编辑与导出

## 六、指标与阈值（首版）
- parseMs ≤ 120ms（P95），renderMs ≤ 150ms（P95），endToEndMs ≤ 200ms（P95）
- 超阈值：状态栏高亮 + 控制台结构化日志 + 可选降级（延迟渲染/分批处理/关闭部分效果）
- 记录：每次导出与渲染任务写入一次采样（不上传，仅本地观测）

## 七、工具与开关（建议）
- 日志级别：info（默认）/debug（调试时开启）
- 性能采样：启用“详细指标”开关以记录更多阶段点
- 降级开关：大文档时自动提示，可手动关闭部分特性（如语法高亮）

## 八、退出标准（完成“调试阶段”）
- 无 P0 问题；P1 问题可接受并有跟踪条目
- 性能 P95 达标；导出四格式通过基线用例
- 错误均可见且可复制文本，任务/进度/详情链路完整

## 九、里程碑与分工（建议）
- D0：建立用例与数据集；打开详细指标；拉齐浏览器版本
- D1-D2：性能/导出并行调试（优先 P0）；记录指标与问题单
- D3：收敛 P0；验证 P95；补文档（已知问题/回退策略）
- D4：评审与冻结，进入下一阶段（M4 打磨）

## 十、问题跟踪建议
- 标签：bug、perf、export、worker、collab、docs
- 单条目的最小信息：环境、重现步骤、期望/实际、日志片段、截图/视频、影响范围

—
作者：研发
日期：2025-08-28
