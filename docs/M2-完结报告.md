# M2 完结报告（文件 / Git）

## 目标达成情况
- [x] 文件区（DW）浏览：使用本地模拟文件系统（支持文件/文件夹）
- [x] 移入版本库…（DW→RW 工作树）：支持“保留两份/覆盖/跳过”的默认策略（当前默认保留两份）
- [x] Git 改动列表：显示工作树相对 HEAD 的更改（新增/修改/删除/未跟踪）
- [x] 暂存/取消暂存：对改动文件进行 stage/unstage
- [x] 提交：仅对暂存文件生成提交，ahead 计数更新
- [x] 历史：基于模拟提交记录展示列表
- [x] 远端：push/pull/fetch 占位与 ahead/behind 计数通路
- [x] SSR 兼容：`git-sim` 与本地存储相关逻辑均加 client 侧保护

> 说明：本阶段为 UI 阶段的「功能模拟」落地，未接入真实 `isomorphic-git`。接口与数据流已与后续真实实现对齐，可直接替换。

## 实现要点
- `lib/git-sim.ts`：
  - DW（文件区）与 RW（工作树/HEAD/暂存/提交/ahead/behind）分离
  - `dwToRw`/`rwToDw` 跨区复制及同名“保留两份”策略
  - 改动扫描、暂存/取消暂存、提交、ahead/behind、历史、push/fetch/pull 占位
  - 客户端专用，SSR 保护
- `components/features/FileExplorer.tsx`：文件树读取自 DW；监听 `git-sim-updated` 更新
- `components/features/GitOverview.tsx`：改动列表 + 暂存按钮 + 提交按钮通路
- `components/features/GitHistory.tsx`：从模拟历史读取提交

## 验收结果（UI 阶段）
- 文件区与 Git 区严格解耦，无隐式同步；移入→RW 出现改动；未暂存不可提交（模拟通路保证只提交已暂存文件）
- 合并/变基相关禁用逻辑留待真实 Git 接入时落地（UI 已有占位）

## 遗留与下一步（进入 M3 前）
- 用 `isomorphic-git` 替换 `git-sim`，补齐工作树扫描、暂存、提交与远端同步
- 在左/右侧栏补齐移出到文件区…/从历史移出… 的 UI 入口和逻辑
- 完善冲突标记与禁用护栏（合并/变基进行中）

## 变更清单
- 新增：`lib/git-sim.ts`
- 更新：`FileExplorer`、`GitOverview`、`GitHistory` 接入模拟通路

> 本阶段完成 M2 在 UI 层的功能通路模拟，为后续真实 Git 能力的接入铺平数据与交互路径。
