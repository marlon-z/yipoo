# Milkdown 源码模式功能指南

## 概述

源码模式是 Milkdown 编辑器的一个强大功能，允许用户在所见即所得（WYSIWYG）编辑和 Markdown 源码编辑之间无缝切换。这个功能特别适合需要精确控制 Markdown 格式的高级用户。

## 功能特性

### 🎯 核心功能

- **双模式编辑**: 在可视化编辑和源码编辑之间自由切换
- **实时同步**: 两种模式之间的内容自动同步
- **语法高亮**: 支持 Markdown 语法的视觉区分
- **行号显示**: 便于代码定位和调试
- **智能缩进**: 自动处理代码缩进和格式

### 🛠️ 编辑功能

- **Tab 缩进**: 支持 Tab 和 Shift+Tab 进行缩进控制
- **多行编辑**: 支持多行选择和批量操作
- **注释切换**: 快速添加或移除 HTML 注释
- **自动保存**: 内容变更自动保存，防止数据丢失
- **快捷键支持**: 完整的编辑器快捷键支持

### 📤 导出功能

- **复制内容**: 一键复制 Markdown 源码到剪贴板
- **下载文件**: 将内容导出为 .md 文件
- **统计信息**: 实时显示行数、字符数、字节数

## 使用方法

### 1. 启用源码模式

在 Milkdown 编辑器的右上角，点击「源码」按钮即可切换到源码模式。

```typescript
// 组件使用示例
import { EnhancedMilkdownEditor } from '@/components/features/EnhancedMilkdownEditor';

export function MyEditor() {
  return <EnhancedMilkdownEditor />;
}
```

### 2. 编辑 Markdown 源码

在源码模式下，你可以直接编辑 Markdown 语法：

```markdown
# 标题示例

## 二级标题

**粗体文本** 和 *斜体文本*

- 列表项 1
- 列表项 2
  - 嵌套列表

\`\`\`javascript
// 代码块示例
const editor = new Crepe({
  root: container,
  defaultValue: markdown
});
\`\`\`

| 表格 | 列 1 | 列 2 |
|------|------|------|
| 数据 | 数据 | 数据 |
```

### 3. 切换回预览模式

点击源码编辑器右上角的「预览」按钮，即可切换回所见即所得模式查看渲染效果。

## 快捷键参考

| 快捷键 | 功能 |
|--------|------|
| `Tab` | 增加缩进 |
| `Shift + Tab` | 减少缩进 |
| `Ctrl/Cmd + S` | 保存文档 |
| `Ctrl/Cmd + /` | 切换注释 |
| `Ctrl/Cmd + A` | 全选内容 |
| `Ctrl/Cmd + Z` | 撤销操作 |
| `Ctrl/Cmd + Y` | 重做操作 |

## 技术实现

### 组件架构

```
EnhancedMilkdownEditor
├── MilkdownEditor (WYSIWYG 模式)
└── CodeMirrorSourceEditor (源码模式)
    ├── 工具栏 (复制、下载、切换)
    ├── 编辑区域 (行号 + 文本编辑器)
    └── 状态栏 (统计信息)
```

### 状态管理

- `isSourceMode`: 控制当前编辑模式
- `markdownContent`: 存储 Markdown 内容
- 双向同步机制确保两种模式内容一致

### 核心特性

1. **防抖保存**: 避免频繁保存操作
2. **内容同步**: 模式切换时自动同步内容
3. **错误处理**: 完善的错误容错机制
4. **性能优化**: 懒加载和按需渲染

## 自定义配置

### 修改默认内容

```typescript
const customDefaultMarkdown = `# 我的文档

这是自定义的默认内容...
`;

// 在 EnhancedMilkdownEditor 中修改 defaultMarkdown 常量
```

### 自定义工具栏

可以通过修改 `CodeMirrorSourceEditor` 组件来自定义工具栏按钮：

```typescript
// 添加新的工具栏按钮
<Button
  variant="ghost"
  size="sm"
  onClick={customAction}
  className="h-8 px-2"
  title="自定义功能"
>
  <CustomIcon className="h-4 w-4" />
</Button>
```

### 样式自定义

源码编辑器使用 Tailwind CSS 类名，可以通过修改类名来自定义样式：

```css
/* 自定义编辑器样式 */
.source-editor {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 14px;
  line-height: 1.6;
}
```

## 最佳实践

### 1. 内容组织

- 使用清晰的标题层次结构
- 合理使用列表和表格
- 代码块添加语言标识

### 2. 性能优化

- 避免在源码模式下编辑超大文档
- 定期保存重要内容
- 使用快捷键提高编辑效率

### 3. 协作建议

- 团队协作时统一 Markdown 格式规范
- 使用版本控制管理文档变更
- 定期备份重要文档

## 故障排除

### 常见问题

1. **切换模式时内容丢失**
   - 确保在切换前内容已保存
   - 检查浏览器控制台是否有错误信息

2. **快捷键不生效**
   - 确认焦点在编辑器内
   - 检查是否与浏览器快捷键冲突

3. **样式显示异常**
   - 检查 CSS 样式是否正确加载
   - 确认 Tailwind CSS 配置正确

### 调试技巧

```javascript
// 在浏览器控制台中调试
console.log('当前模式:', isSourceMode);
console.log('内容长度:', markdownContent.length);
console.log('编辑器实例:', editorRef.current);
```

## 更新日志

### v1.0.0 (2025-01-15)
- ✨ 初始版本发布
- ✅ 支持双模式切换
- ✅ 完整的编辑功能
- ✅ 导出和复制功能

### 计划功能

- [ ] 语法高亮增强
- [ ] 代码折叠功能
- [ ] 搜索和替换
- [ ] 多主题支持
- [ ] 插件系统

## 贡献指南

欢迎提交 Issue 和 Pull Request 来改进源码模式功能！

### 开发环境

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建项目
npm run build
```

### 提交规范

- feat: 新功能
- fix: 修复 bug
- docs: 文档更新
- style: 代码格式调整
- refactor: 代码重构

---

*最后更新: 2025-01-15* 