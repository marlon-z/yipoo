好的。按你最新结论——**主编辑器只用 Milkdown**（它内部已用 CodeMirror 6，足够了）——这里是**中心区域说明**，只写确认过的点，清晰不啰嗦。

---

# 中心区域（以 Milkdown 为主）

## 1) 作用与边界

* **作用**：写 Markdown（默认所见即所得），预览与目录跳转。
* **边界**：不做 Git 操作；保存只写到**文件区（DW）**，与 **Git 区（RW）** 解耦。

---

## 2) 结构

```
[ 模式切换条 ]  （所见即所得｜源码｜分屏）
[ 编辑区 ]      （Milkdown：唯一编辑器实例）
[ 预览区 ]      （仅分屏时显示，只读 HTML）
[ 右侧内嵌目录（TOC） ]
```

* 只有 **一个**活跃编辑器（Milkdown）。分屏时右侧是只读预览，并不是第二个编辑器。

---

## 3) 模式说明（全部基于 Milkdown）

1. **所见即所得（默认）**

   * 标题、段落、列表、引用、链接、图片、表格、任务清单、代码块等常规写作。
   * 代码块由 Milkdown 内部的 **CodeMirror 6** 渲染（已确认，无需单独集成 CM6）。

2. **源码模式**

   * 使用 **Milkdown 的源码视图**（其内部同样用 CM6）。
   * 目的：查看/编辑整篇 Markdown 源，不额外接入独立的 CodeMirror。

3. **分屏模式**

   * 左侧继续用 Milkdown 编辑；右侧是只读预览。
   * 两侧滚动同步；点击预览标题可回到编辑位置。

> 切换模式时尽量**保留光标与滚动位置**。

---

## 4) 目录（TOC）

* 目录由**解析层**生成（只读，不写回正文），支持：

  * 显示层级（H1–H6）、搜索、折叠、当前标题高亮。
* 点击目录项 → **编辑区跳到对应标题**；分屏时预览同步对齐。
* 锚点稳定：同名自动去重；小改名尽量保留原锚点。

---

## 5) 粘贴 / 图片 / 文件归属

* 粘贴网页文字：保留常见样式（加粗、斜体、链接、列表、表格）。
* 图片可粘贴或拖拽：文件保存到**文件区（DW）**，正文使用**相对路径**引用。
* 不在中心区做“移入/移出”；与 Git 无关。

---

## 6) 保存与恢复（全局机制在这里落地）

* **自动保存**：停止输入片刻即保存；长写作会周期性把全文写入 DW。
* **高风险前**（导出、移入/移出、离开页面、切模式可选）：先保存。
* **崩溃/刷新后**重开：顶部提示“发现未保存内容”，一键恢复。
* 以上只影响 **DW**，**不会触发 Git**。

---

## 7) 与两侧栏的配合

* **左侧栏**：双击文件在此打开；移入/移出在左侧完成，中心区不参与。
* **右侧栏**：外观与渲染开关（高亮、公式、Mermaid、图片懒加载）**即时生效**；不改正文。

---

## 8) 明确不做

* 不接第二套 CodeMirror；**源码模式走 Milkdown 的源码视图**即可。
* 不把目录写进正文。
* 不在中心区触发 Git（提交/推送/拉取等）。

---

## 9) 验收要点

* 默认用 **Milkdown** 打开；所见/源码/分屏三模式可切换且**光标与滚动保留**。
* 代码块渲染正常（由 Milkdown 内置 **CM6** 完成）。
* 目录点击 **<150ms** 定位成功；分屏滚动同步。
* 粘贴/图片：图片落在 **DW**，正文相对路径引用。
* 导出或移入/移出前会先保存；刷新后出现恢复提示并能恢复。

> 结论：**中心区域只用 Milkdown**（其内部已用 CM6），即可覆盖所见写作、整篇源码视图和分屏预览，无需再单独接入一套 CodeMirror。
