好的，我只按我们**已讨论并确认**的内容，把 **Topbar（顶部栏）** 说明清楚：不脑补、不扩展。

---

# Topbar（顶部栏）

## 1) 位置与作用

* 位于页面最上方，提供**同步、导出、协作、设置**等全局入口。
* 不直接改动文件内容；**不会触发任何自动 Git 操作**。

---

## 2) 组成

* **左侧**：Logo 与基础菜单（新建/打开/保存、查找、视图等）。
* **中间**：当前文件名；文件名右侧的小点 **`●` 表示“内容还没写入文件（DW 检查点未完成）”**。
* **右侧按钮**：

  * **同步**：`Fetch / Pull / Push`（一个下拉或分组按钮，显示当前分支与 ↑/↓ 计数）
  * **导出**：`Markdown / HTML / PDF / Docx`
  * **协作（可选）**：开/关协作、查看在线成员
  * **设置**：打开右侧设置面板

> 注：**移入版本库… / 移出到文件区…** 在左侧栏，不在 Topbar。

---

## 3) 行为规则（已确认）

### 3.1 同步（Git）

* **Fetch / Pull / Push** 只影响 **Git 区（RW）** 的状态，**不会改“文件区（DW）”**。
* **合并/变基进行中**：只允许 **Fetch**；其他同步项禁用并给出提示。

### 3.2 导出

* 支持导出为 **MD / HTML / PDF / Docx**。
* **导出前会先保存一次**（防止导出旧内容），然后生成下载。
* 导出不触发 Git 提交或推送。

### 3.3 协作（可选）

* 打开/关闭协作；显示房间信息与在线成员。
* 协作与 Git 无关；断网会尝试重连。

### 3.4 设置

* 打开右侧设置面板（外观、渲染、目录、导出选项等）。

---

## 4) 与全局保存的配合

* **强制保存触发点**（Topbar 侧）：

  * 点击 **导出** 时：先保存（写入本地，确保最新）。
  * 触发导航离开/刷新前（浏览器事件）：先保存。
* 保存只写到 **文件区（DW）**；**不会自动提交到 Git**。

---

## 5) 状态展示

* 文件名后的 **`●`**：表示“当前编辑内容尚未写入文件（DW 检查点未完成）”。
* 同步按钮旁显示：当前**分支名**、**领先/落后数量**（↑/↓）。
* 操作中的进度与错误，会同步在**底部状态栏**显示（不打断编辑）。

---

## 6) 禁用与提示（统一护栏）

* **合并/变基进行中**：Pull/Push 禁用（只留 Fetch），并显示原因提示。
* **未暂存时**：提交在 Git 区禁用；Topbar 不提供提交入口（避免混淆）。
* **离线**：同步相关项禁用并提示离线状态；导出仍可用。

---

## 7) 与其他区域的联动

* **左侧栏**：Topbar 的同步只改变 Git 区状态；“移入/移出”仍在左侧按钮/右键完成。
* **中央编辑区**：导出前触发保存，防止内容差异。
* **右侧栏**：Topbar 的“设置/协作”按钮只负责打开对应面板。
* **状态栏**：显示同步结果、导出进度/错误、最近保存时间等。

---

## 8) 不做什么（确认不包含）

* 不提供“移入版本库… / 移出到文件区…”入口。
* 不自动提交/推送；任何导出或保存都**不会**触发 Git 操作。
* 不在 Topbar 直接编辑文件名或内容（重命名在文件区进行）。
